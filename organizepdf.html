<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Organize PDF | Reorder Pages Instantly | SRJ Tools</title>

  <link rel="stylesheet" href="style.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
<canvas id="waveCanvas"></canvas>

<header class="header">
  <h1 class="title-under-logo">Organize PDF</h1>
  <p class="subtitle">Reorder PDF pages by dragging thumbnails</p>
</header>

<section class="converter-section">
  <div class="converter-box">
    <input type="file" id="fileInput" accept="application/pdf" />
    <button id="loadBtn">Load PDF</button>

    <div class="progress-container" id="progressContainer" style="display:none;">
      <div id="progressBar"></div>
    </div>

    <button class="back-btn" onclick="window.location.href='index.html'">← Back to Home</button>
  </div>

  <div id="pagesContainer" class="pages-grid"></div>

  <button id="confirmBtn" class="download-btn" style="display:none;">Confirm Organization</button>

  <button id="downloadBtn" class="download-btn" style="display:none;">
    Download Organized PDF
  </button>
</section>

<footer class="footer">
  <p>© 2025 SRJahir Tech | Powered by CloudAI</p>
</footer>

<script>
  const fileInput = document.getElementById("fileInput");
  const loadBtn = document.getElementById("loadBtn");
  const pagesContainer = document.getElementById("pagesContainer");
  const confirmBtn = document.getElementById("confirmBtn");
  const downloadBtn = document.getElementById("downloadBtn");
  const progressBar = document.getElementById("progressBar");
  const progressContainer = document.getElementById("progressContainer");

  let pdfPages = [];
  let sortedPages = [];

  loadBtn.addEventListener("click", () => {
    const file = fileInput.files[0];
    if (!file) return alert("Please select a PDF file!");
    loadPDF(file);
  });

  async function loadPDF(file) {
    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

    pagesContainer.innerHTML = "";
    pdfPages = [];

    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const viewport = page.getViewport({ scale: 0.25 });

      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({ canvasContext: ctx, viewport }).promise;

      const wrapper = document.createElement("div");
      wrapper.className = "page-item";
      wrapper.draggable = true;
      wrapper.dataset.page = i;

      wrapper.appendChild(canvas);

      const label = document.createElement("p");
      label.innerText = `Page ${i}`;
      wrapper.appendChild(label);

      pagesContainer.appendChild(wrapper);
      pdfPages.push({ num: i, canvas });
    }

    enableDrag();
    confirmBtn.style.display = "block";
  }

  function enableDrag() {
    let dragged = null;

    document.querySelectorAll(".page-item").forEach((item) => {
      item.addEventListener("dragstart", () => {
        dragged = item;
        item.classList.add("dragging");
      });

      item.addEventListener("dragend", () => {
        item.classList.remove("dragging");
      });

      item.addEventListener("dragover", (e) => e.preventDefault());

      item.addEventListener("drop", (e) => {
        e.preventDefault();
        if (dragged !== item) {
          pagesContainer.insertBefore(dragged, item);
        }
      });
    });
  }

  confirmBtn.addEventListener("click", () => {
    progressContainer.style.display = "block";
    progressBar.style.width = "0%";

    let p = 0;
    const interval = setInterval(() => {
      p += 25;
      progressBar.style.width = p + "%";

      if (p >= 100) {
        clearInterval(interval);
        sortedPages = Array.from(document.querySelectorAll(".page-item"))
          .map((div) => parseInt(div.dataset.page) - 1);

        downloadBtn.style.display = "block";
      }
    }, 300);
  });

  downloadBtn.addEventListener("click", generateFinalPDF);

  async function generateFinalPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    sortedPages.forEach((index, i) => {
      const canvas = pdfPages[index].canvas;
      const img = canvas.toDataURL("image/jpeg", 1.0);

      if (i !== 0) pdf.addPage();
      pdf.addImage(img, "JPEG", 0, 0, 210, 297);
    });

    pdf.save("Organized.pdf");
  }
</script>

</body>
</html>