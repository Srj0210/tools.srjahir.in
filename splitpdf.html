<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Split PDF pages instantly with SRJ Tools. Preview all PDF pages visually, select required pages, and extract them securely. Free • Fast • Cloud-based.">
    <meta name="keywords" content="Split PDF, Extract PDF pages, SRJ Tools, Free PDF Tools, CloudAI, PDF page selector, PDF utilities">
    <meta name="author" content="SRJahir Tech">

    <title>Split PDF Pages – SRJ Tools</title>
    <link rel="stylesheet" href="/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="ga.js"></script>
</head>

<body>
    <canvas id="waveCanvas"></canvas>

    <header class="header">
        <div class="logo-container">
            <img src="/assets/cloud.png" class="cloud">
            <img src="/assets/gear-ring.png" class="gear">
            <img src="/assets/code-center.png" class="center">
        </div>

        <h1 class="title-under-logo">Split PDF Pages</h1>
        <p class="subtitle">Preview & extract selected pages instantly</p>
    </header>

    <section class="converter-section">
        <div class="converter-box">
            <input type="file" id="pdfFile" accept="application/pdf">

            <div id="thumbnailContainer" style="margin-top:15px;"></div>

            <button id="splitSelected" class="download-btn" style="display:none;margin-top:20px;">
                Split Selected Pages
            </button>

            <div class="progress-container">
                <div id="progressBar"></div>
            </div>

            <div id="downloadBox"></div>

            <button onclick="location.href='/index.html';" class="back-btn">
                ← Back to Home
            </button>
        </div>

        <div style="text-align:center;margin-top:25px;color:#8fb8ff;">
            <h3>How It Works</h3>
            <p>Upload → Auto Preview → Select Pages → Split → Download final PDF</p>
        </div>
    </section>

    <footer class="footer">
        © 2025 SRJahir Tech | Powered by CloudAI
    </footer>


    <script>
        // ====== PDF.js Setup ======
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

        const fileInput = document.getElementById("pdfFile");
        const container = document.getElementById("thumbnailContainer");
        const splitBtn = document.getElementById("splitSelected");
        const downloadBox = document.getElementById("downloadBox");
        const progressBar = document.getElementById("progressBar");

        let currentFile = null;


        // -------- Auto Preview Thumbnails --------
        fileInput.addEventListener("change", async () => {
            const file = fileInput.files[0];
            if (!file) return;

            currentFile = file;
            container.innerHTML = "";
            downloadBox.innerHTML = "";
            splitBtn.style.display = "none";
            progressBar.style.width = "0%";

            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);

                const viewport = page.getViewport({ scale: 0.3 });
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");

                canvas.width = viewport.width;
                canvas.height = viewport.height;

                await page.render({ canvasContext: ctx, viewport }).promise;

                const box = document.createElement("div");
                box.className = "thumb";

                box.innerHTML = `
                    <img src="${canvas.toDataURL()}" alt="Page ${i}">
                    <div style="text-align:center;margin-top:8px;">
                        <input type="checkbox" class="pageCheck" value="${i}">
                        <label style="color:#d7e3ff;font-size:0.9rem;">Page ${i}</label>
                    </div>
                `;

                container.appendChild(box);
            }

            splitBtn.style.display = "inline-block";
        });


        // -------- Split Request --------
        splitBtn.addEventListener("click", async () => {
            const checks = [...document.querySelectorAll(".pageCheck:checked")].map(x => x.value);
            if (!checks.length) return alert("Select pages first!");

            const form = new FormData();
            form.append("file", currentFile);
            form.append("pages", checks.join(","));

            progressBar.style.width = "40%";

            const res = await fetch("https://api.srjahir.in/split-pdf", {
                method: "POST",
                body: form
            });

            if (!res.ok) {
                progressBar.style.width = "0%";
                return alert("Error splitting PDF. Try again.");
            }

            const blob = await res.blob();
            progressBar.style.width = "100%";

            const url = URL.createObjectURL(blob);

            downloadBox.innerHTML = `
                <div class="success-box">
                    ✔ Split Successful!<br>
                    <button class="download-btn" onclick="downloadFile('${url}')">Download PDF</button>
                </div>
            `;
        });


        function downloadFile(url) {
            const a = document.createElement("a");
            a.href = url;
            a.download = "Extracted_Pages.pdf";
            a.click();
        }
    </script>


    <style>
        #thumbnailContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .thumb {
            background: rgba(20, 40, 80, 0.5);
            border: 1px solid rgba(0, 140, 255, 0.2);
            padding: 10px;
            border-radius: 12px;
            width: 150px;
            text-align: center;
        }

        .thumb img {
            width: 100%;
            border-radius: 8px;
        }
    </style>

</body>
</html>